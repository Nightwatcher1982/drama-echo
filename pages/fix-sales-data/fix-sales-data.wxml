<!--ä¿®å¤é”€å”®æ•°æ®é¡µé¢-->
<view class="container">
  <view class="header">
    <view class="title">ğŸ”§ ä¿®å¤é”€å”®æ•°æ®</view>
    <view class="subtitle">è§£å†³è¯­éŸ³åŒ…IDä¸è´­ä¹°è®°å½•ä¸åŒ¹é…çš„é—®é¢˜</view>
  </view>

  <view class="steps">
    <view class="step {{currentStep >= 1 ? 'active' : ''}}">
      <view class="step-number">1</view>
      <view class="step-text">åˆ†ææ•°æ®</view>
    </view>
    <view class="step {{currentStep >= 2 ? 'active' : ''}}">
      <view class="step-number">2</view>
      <view class="step-text">åˆ›å»ºæ˜ å°„</view>
    </view>
    <view class="step {{currentStep >= 3 ? 'active' : ''}}">
      <view class="step-number">3</view>
      <view class="step-text">æ¸…ç†è„æ•°æ®</view>
    </view>
    <view class="step {{currentStep >= 4 ? 'active' : ''}}">
      <view class="step-number">4</view>
      <view class="step-text">åˆ›å»ºè¯­éŸ³åŒ…</view>
    </view>
    <view class="step {{currentStep >= 5 ? 'active' : ''}}">
      <view class="step-number">5</view>
      <view class="step-text">æ›´æ–°é”€é‡</view>
    </view>
  </view>

  <view class="actions">
    <button class="action-btn" bindtap="analyzeData" disabled="{{loading}}">
      {{loading && currentStep === 1 ? 'åˆ†æä¸­...' : 'æ­¥éª¤1ï¼šåˆ†ææ•°æ®å…³è”æƒ…å†µ'}}
    </button>
    
    <button class="action-btn" bindtap="createMapping" disabled="{{loading || !analysisResult}}">
      {{loading && currentStep === 2 ? 'åˆ›å»ºä¸­...' : 'æ­¥éª¤2ï¼šåˆ›å»ºæ˜ å°„å…³ç³»'}}
    </button>
    
    <button class="action-btn" bindtap="cleanupData" disabled="{{loading || !mappingResult}}">
      {{loading && currentStep === 3 ? 'æ¸…ç†ä¸­...' : 'æ­¥éª¤3ï¼šæ¸…ç†è„æ•°æ®ï¼ˆåˆ é™¤æœªåŒ¹é…çš„è´­ä¹°è®°å½•ï¼‰'}}
    </button>
    
    <button class="action-btn" bindtap="createMissingPacks" disabled="{{loading || !updateResult}}">
      {{loading && currentStep === 4 ? 'åˆ›å»ºä¸­...' : 'æ­¥éª¤4ï¼šä¸ºæœ‰è´­ä¹°è®°å½•çš„packIdåˆ›å»ºè¯­éŸ³åŒ…'}}
    </button>
    
    <button class="action-btn" bindtap="updateVoicePackSales" disabled="{{loading || !updateResult}}">
      {{loading && currentStep === 5 ? 'æ›´æ–°ä¸­...' : 'æ­¥éª¤5ï¼šæ›´æ–°è¯­éŸ³åŒ…é”€é‡'}}
    </button>
    
    <button class="action-btn secondary" bindtap="copyResult" wx:if="{{analysisResult || mappingResult || updateResult}}">
      å¤åˆ¶ç»“æœ
    </button>
    
    <button class="action-btn danger" bindtap="resetData">
      é‡ç½®æ•°æ®
    </button>
  </view>

  <view class="result-section" wx:if="{{analysisResult}}">
    <view class="result-title">ğŸ“Š æ•°æ®åˆ†æç»“æœ</view>
    <view class="result-content">
      <view class="result-item">
        <text class="result-label">æ€»è¯­éŸ³åŒ…æ•°ï¼š</text>
        <text class="result-value">{{analysisResult.totalVoicePacks}}</text>
      </view>
      <view class="result-item">
        <text class="result-label">æ€»è´­ä¹°è®°å½•ï¼š</text>
        <text class="result-value">{{analysisResult.totalPurchases}}</text>
      </view>
      <view class="result-item">
        <text class="result-label">åŒ¹é…ç‡ï¼š</text>
        <text class="result-value">{{analysisResult.matchRate}}%</text>
      </view>
      <view class="result-item">
        <text class="result-label">æœªåŒ¹é…è´­ä¹°è®°å½•ï¼š</text>
        <text class="result-value">{{analysisResult.unmatchedPurchases.length}}</text>
      </view>
    </view>
  </view>

  <view class="result-section" wx:if="{{mappingResult}}">
    <view class="result-title">ğŸ”— æ˜ å°„å…³ç³»ç»“æœ</view>
    <view class="result-content">
      <view class="result-item">
        <text class="result-label">æ‰¾åˆ°æ˜ å°„å…³ç³»ï¼š</text>
        <text class="result-value">{{mappingResult.totalMappings}}</text>
      </view>
    </view>
  </view>

  <view class="result-section" wx:if="{{updateResult}}">
    <view class="result-title">âœ… ä¿®å¤ç»“æœ</view>
    <view class="result-content">
      <view class="result-item" wx:if="{{updateResult.totalDeleted !== undefined}}">
        <text class="result-label">æ¸…ç†çš„è„æ•°æ®ï¼š</text>
        <text class="result-value">{{updateResult.totalDeleted}} æ¡</text>
      </view>
      <view class="result-item" wx:if="{{updateResult.totalCreated !== undefined}}">
        <text class="result-label">åˆ›å»ºçš„è¯­éŸ³åŒ…ï¼š</text>
        <text class="result-value">{{updateResult.totalCreated}} ä¸ª</text>
      </view>
      <view class="result-item" wx:if="{{updateResult.debugInfo}}">
        <text class="result-label">è°ƒè¯•ä¿¡æ¯ï¼š</text>
        <text class="result-value">æŸ¥çœ‹æ§åˆ¶å°</text>
      </view>
      <view class="result-item" wx:if="{{updateResult.totalUpdated !== undefined}}">
        <text class="result-label">æ›´æ–°çš„è¯­éŸ³åŒ…ï¼š</text>
        <text class="result-value">{{updateResult.totalUpdated}} ä¸ª</text>
      </view>
    </view>
  </view>
</view>
