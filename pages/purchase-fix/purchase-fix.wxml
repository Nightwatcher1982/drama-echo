<view class="container">
  <view class="page-header">
    <view class="header-icon">🛒</view>
    <view class="page-title">购买状态修复</view>
    <view class="page-subtitle">为当前用户创建购买记录</view>
  </view>

  <!-- 管理员功能区 -->
  <view wx:if="{{isAdmin}}" class="admin-section">
    
    <!-- 创建按钮 -->
    <view class="action-section glass-card">
      <view class="section-title">
        <view class="title-icon">🎯</view>
        <view class="title-text">购买记录修复</view>
      </view>
      
      <view class="info-text">
        <text class="description">此功能将为你创建一些测试用的购买记录，让你可以正常播放语音包。</text>
      </view>
      
      <view class="action-buttons">
        <button 
          class="fix-btn {{loading ? 'loading' : ''}}" 
          bindtap="createPurchases"
          disabled="{{loading}}"
        >
          <view class="btn-icon">{{loading ? '⏳' : '🔧'}}</view>
          <view class="btn-text">{{loading ? '创建中...' : '创建购买记录'}}</view>
        </button>
      </view>
      
      <view class="purchase-info">
        <text class="info-title">将会创建以下购买记录：</text>
        <view class="purchase-list">
          <text class="purchase-item">• 李雨萱 - 昆曲经典选段 ¥29.99</text>
          <text class="purchase-item">• 李雨萱 - 古诗词朗诵 ¥19.99</text>  
          <text class="purchase-item">• 陈墨轩 - 现代情感独白 ¥24.99</text>
          <text class="purchase-item">• 苏婉清 - 越剧经典唱段 ¥26.99</text>
        </view>
      </view>
    </view>

    <!-- 结果显示 -->
    <view wx:if="{{result}}" class="result-section glass-card">
      <view class="section-title">
        <view class="title-icon">{{result.success ? '✅' : '❌'}}</view>
        <view class="title-text">创建结果</view>
      </view>
      
      <view class="result-content">
        <view class="result-status {{result.success ? 'success' : 'error'}}">
          {{result.message}}
        </view>
        
        <view wx:if="{{result.success && result.data}}" class="result-details">
          <view class="detail-item">
            <text class="detail-label">成功创建：</text>
            <text class="detail-value">{{result.data.successCount}} 条记录</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">用户ID：</text>
            <text class="detail-value">{{result.data.openid}}</text>
          </view>
          <view wx:if="{{result.data.message}}" class="detail-item">
            <text class="detail-message">{{result.data.message}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 测试按钮 -->
    <view wx:if="{{result && result.success}}" class="test-section glass-card">
      <view class="section-title">
        <view class="title-icon">🧪</view>
        <view class="title-text">功能测试</view>
      </view>
      
      <view class="test-info">
        <text class="test-text">购买记录已创建，现在可以正常播放语音包了！</text>
      </view>
      
      <button class="test-btn" bindtap="testVoiceEcho">
        <view class="btn-icon">🎭</view>
        <view class="btn-text">测试戏剧回响</view>
      </button>
    </view>

  </view>

  <!-- 非管理员提示 -->
  <view wx:else class="no-permission glass-card">
    <view class="no-permission-icon">🔒</view>
    <view class="no-permission-text">需要管理员权限才能使用此功能</view>
  </view>

  <!-- 返回按钮 -->
  <view class="back-section">
    <button class="back-btn" bindtap="goBack">
      <view class="btn-text">返回</view>
    </button>
  </view>
</view>