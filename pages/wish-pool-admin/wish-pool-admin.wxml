<!--è®¸æ„¿æ± ç®¡ç†é¡µé¢-->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <view class="page-title">è®¸æ„¿æ± ç®¡ç†</view>
    <view class="header-actions">
      <button class="btn-refresh" bindtap="refreshData">ğŸ”„ åˆ·æ–°</button>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>

  <view wx:else>
    <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
    <view class="tab-container">
      <view class="tab-item {{currentTab === 'list' ? 'active' : ''}}" 
            bindtap="switchTab" data-tab="list">
        è®¸æ„¿åˆ—è¡¨
      </view>
      <view class="tab-item {{currentTab === 'stats' ? 'active' : ''}}" 
            bindtap="switchTab" data-tab="stats">
        æ•°æ®ç»Ÿè®¡
      </view>
    </view>

    <!-- è®¸æ„¿åˆ—è¡¨ -->
    <view wx:if="{{currentTab === 'list'}}" class="wish-list-container">
      <!-- æœç´¢æ¡† -->
      <view class="search-container">
        <input class="search-input" 
               placeholder="æœç´¢è®¸æ„¿å†…å®¹æˆ–ç”¨æˆ·å..." 
               bindinput="onSearchInput"
               value="{{searchKeyword}}" />
      </view>

      <!-- è®¸æ„¿åˆ—è¡¨ -->
      <view class="wish-list">
        <view wx:for="{{filteredWishes}}" wx:key="_id" class="wish-item">
          <view class="wish-content" bindtap="viewWishDetail" data-wish="{{item}}">
            <view class="wish-text">{{item.content}}</view>
            <view class="wish-meta">
              <view class="wish-user">ç”¨æˆ· {{item.userNickName}}</view>
              <view class="wish-time">ğŸ•’ {{item.createTimeFormatted}}</view>
            </view>
          </view>
          <view class="wish-support">
            <view class="support-count {{item.supportCount > 0 ? 'has-support' : 'no-support'}}">
              {{item.supportCount > 0 ? 'ğŸ”¥' : 'â„ï¸'}} {{item.supportCount}}
            </view>
            <view class="support-label">åŠ©åŠ›</view>
          </view>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view wx:if="{{filteredWishes.length === 0}}" class="empty-state">
        <view class="empty-icon">ğŸ‹</view>
        <view class="empty-text">æš‚æ— è®¸æ„¿æ•°æ®</view>
      </view>
    </view>

    <!-- æ•°æ®ç»Ÿè®¡ -->
    <view wx:if="{{currentTab === 'stats'}}" class="stats-container">
      <!-- æ€»ä½“ç»Ÿè®¡ -->
      <view class="stats-section">
        <view class="section-title">æ€»ä½“ç»Ÿè®¡</view>
        <view class="stats-grid">
          <view class="stat-item">
            <view class="stat-number">{{totalWishes}}</view>
            <view class="stat-label">æ€»è®¸æ„¿æ•°</view>
          </view>
          <view class="stat-item">
            <view class="stat-number">{{totalSupports}}</view>
            <view class="stat-label">æ€»åŠ©åŠ›æ•°</view>
          </view>
          <view class="stat-item">
            <view class="stat-number">{{todayWishes}}</view>
            <view class="stat-label">ä»Šæ—¥è®¸æ„¿</view>
          </view>
          <view class="stat-item">
            <view class="stat-number">{{todaySupports}}</view>
            <view class="stat-label">ä»Šæ—¥åŠ©åŠ›</view>
          </view>
        </view>
      </view>

      <!-- çƒ­é—¨è®¸æ„¿ -->
      <view class="stats-section">
        <view class="section-title">çƒ­é—¨è®¸æ„¿ TOP5</view>
        <view class="top-wishes">
          <view wx:for="{{topWishes}}" wx:key="_id" class="top-wish-item">
            <view class="rank-number">{{index + 1}}</view>
            <view class="top-wish-content">
              <view class="top-wish-text">{{item.content}}</view>
              <view class="top-wish-meta">
                <text class="top-wish-user">{{item.userNickName}}</text>
                <text class="top-wish-time">{{item.createTimeFormatted}}</text>
              </view>
            </view>
            <view class="top-wish-support">
              <view class="support-count">{{item.supportCount}}</view>
              <view class="support-label">åŠ©åŠ›</view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>
