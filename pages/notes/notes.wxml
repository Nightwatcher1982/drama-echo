<view class="container fade-in">
  <view class="page-title">戏剧笔记</view>
  <view class="page-subtitle">记录每一次观剧的美好时光</view>

  <!-- 搜索和筛选 -->
  <view class="search-section glass-card">
    <view class="search-bar">
      <input 
        class="search-input" 
        placeholder="搜索剧目名称、剧院..." 
        value="{{searchText}}"
        bindinput="onSearchInput"
      />
      <view class="search-icon" bindtap="onSearch">🔍</view>
    </view>
    <view class="filter-tabs">
      <view 
        class="filter-tab {{activeFilter === 'all' ? 'active' : ''}}"
        data-filter="all"
        bindtap="switchFilter"
      >全部</view>
      <view 
        class="filter-tab {{activeFilter === 'recent' ? 'active' : ''}}"
        data-filter="recent"
        bindtap="switchFilter"
      >最近</view>
      <view 
        class="filter-tab {{activeFilter === 'favorite' ? 'active' : ''}}"
        data-filter="favorite"
        bindtap="switchFilter"
      >收藏</view>
    </view>
  </view>

  <!-- 快速添加 -->
  <view class="quick-add glass-card">
    <button class="add-note-btn" bindtap="createNewNote">
      <view class="add-icon">✨</view>
      <view class="add-text">
        <view class="add-title">记录新的观剧体验</view>
        <view class="add-desc">分享你的戏剧故事，获得50戏剧币</view>
      </view>
    </button>
  </view>

  <!-- 笔记列表 -->
  <view class="notes-list" wx:if="{{filteredNotes.length > 0}}">
    <view 
      class="note-item glass-card"
      wx:for="{{filteredNotes}}"
      wx:key="id"
      bindtap="viewNote"
      data-note-id="{{item.id}}"
    >
      <view class="note-header">
        <view class="note-cover">
          <image 
            class="cover-image" 
            src="{{item.coverImage}}"
            mode="aspectFill"
            binderror="onImageError"
            bindload="onImageLoad"
          />
          <view class="image-placeholder" wx:if="{{!item.coverImage || item.coverImage === '/images/modu.png'}}">🎭</view>
          <view class="note-rating" wx:if="{{item.rating}}">
            <view class="rating-stars">
              <text wx:for="{{item.ratingStars}}" wx:key="*this">{{item}}</text>
            </view>
          </view>
        </view>
        <view class="note-info">
          <view class="note-title">{{item.dramaTitle}}</view>
          <view class="note-meta">
            <view class="note-theater">📍 {{item.theater}}</view>
            <view class="note-date">📅 {{item.watchDate}}</view>
          </view>
          <view class="note-preview">{{item.content}}</view>
          <view class="note-tags" wx:if="{{item.tags.length > 0}}">
            <text class="tag" wx:for="{{item.tags}}" wx:key="*this">#{{item}}</text>
          </view>
        </view>
      </view>
      <view class="note-footer">
        <view class="note-stats">
          <view class="stat-item">
            <text class="stat-icon">👀</text>
            <text class="stat-count">{{item.views || 0}}</text>
          </view>
          <view class="stat-item">
            <text class="stat-icon">❤️</text>
            <text class="stat-count">{{item.likes || 0}}</text>
          </view>
          <view class="stat-item">
            <text class="stat-icon">🔗</text>
            <text class="stat-count">{{item.shares || 0}}</text>
          </view>
        </view>
        <view class="note-actions">
          <button 
            class="action-btn share-btn" 
            data-note-id="{{item.id}}"
            bindtap="shareNote"
            size="mini"
          >分享</button>
          <button 
            class="action-btn edit-btn"
            data-note-id="{{item.id}}"
            bindtap="editNote"
            size="mini"
          >编辑</button>
        </view>
      </view>
    </view>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:else>
    <view class="empty-icon">📝</view>
    <view class="empty-title">还没有戏剧笔记</view>
    <view class="empty-desc">记录你的第一次观剧体验吧</view>
    <button class="btn-primary empty-btn" bindtap="createNewNote">
      <view class="btn-text">开始记录</view>
    </button>
  </view>

  <!-- 统计信息 -->
  <view class="stats-summary glass-card" wx:if="{{notesList.length > 0}}">
    <view class="stats-title">📊 我的观剧数据</view>
    <view class="stats-grid">
      <view class="stat-item">
        <view class="stat-number">{{totalNotes}}</view>
        <view class="stat-label">总笔记数</view>
      </view>
      <view class="stat-item">
        <view class="stat-number">{{totalShows}}</view>
        <view class="stat-label">观剧场次</view>
      </view>
      <view class="stat-item">
        <view class="stat-number">{{favoriteTheater}}</view>
        <view class="stat-label">最爱剧院</view>
      </view>
      <view class="stat-item">
        <view class="stat-number">{{totalEarned}}</view>
        <view class="stat-label">获得积分</view>
      </view>
    </view>
  </view>
</view> 