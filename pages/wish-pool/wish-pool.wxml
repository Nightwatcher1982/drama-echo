<!-- 许愿池页面 -->
<view class="container">
  <!-- 许愿池标题 -->
  <view class="wish-pool-title">
    <view class="title-container">
      <view class="title-decoration">✨</view>
      <view class="title-text">许愿池</view>
      <view class="title-decoration">✨</view>
    </view>
  </view>

  <!-- 许愿池内容 -->
  <view class="wish-pool-content">
    <!-- 许愿气泡列表 -->
    <view class="wish-bubbles">
      <view 
        wx:for="{{wishes}}" 
        wx:key="_id" 
        class="wish-bubble wish-level-{{item.level}}"
        bindtap="onWishLike"
        data-wish-id="{{item._id}}"
        data-liked="{{item.liked}}"
      >
        <view class="bubble-content">{{item.content}}</view>
      </view>
    </view>

    <!-- 加载更多 -->
    <view wx:if="{{loading}}" class="loading">
      <text>加载中...</text>
    </view>
    
    <view wx:if="{{!hasMore && wishes.length > 0}}" class="no-more">
      <text>没有更多许愿了</text>
    </view>

    <!-- 空状态 -->
    <view wx:if="{{wishes.length === 0 && !loading}}" class="empty-state">
      <view class="empty-icon">🌟</view>
      <view class="empty-text">还没有许愿，快来许下第一个愿望吧！</view>
      <!-- 临时：创建索引按钮 -->
      <button class="create-index-btn" bindtap="createIndexes" size="mini">
        创建数据库索引
      </button>
    </view>
  </view>

  <!-- 许愿按钮 -->
  <view class="wish-button-container">
    <button class="wish-button" bindtap="showWishModal">
      <view class="wish-button-content">
        <view class="wish-button-icon">✨</view>
        <view class="wish-button-text">许下愿望</view>
      </view>
    </button>
  </view>
</view>

<!-- 许愿弹窗 -->
<view wx:if="{{showWishModal}}" class="modal-overlay" bindtap="closeWishModal">
  <view class="modal-content" catchtap="preventClose">
    <view class="modal-header">
      <view class="modal-title">许下你的愿望</view>
      <view class="modal-close" bindtap="closeWishModal">×</view>
    </view>
    
    <view class="modal-body">
      <view class="input-group">
        <view class="input-label">希望听到谁的声音</view>
        <input 
          class="wish-input"
          placeholder="请输入演员姓名"
          value="{{wishActor}}"
          bindinput="onActorInput"
          maxlength="10"
        />
        <view class="char-count">{{wishActor.length}}/10</view>
      </view>
      
      <view class="input-group">
        <view class="input-label">希望Ta对你说什么</view>
        <textarea 
          class="wish-input"
          placeholder="请输入希望听到的话"
          value="{{wishMessage}}"
          bindinput="onMessageInput"
          maxlength="100"
          auto-height
        ></textarea>
        <view class="char-count">{{wishMessage.length}}/100</view>
      </view>
      
      <view class="input-group">
        <view class="input-label">其他</view>
        <textarea 
          class="wish-input"
          placeholder="其他想说的话（可选）"
          value="{{wishOther}}"
          bindinput="onOtherInput"
          maxlength="100"
          auto-height
        ></textarea>
        <view class="char-count">{{wishOther.length}}/100</view>
      </view>
    </view>
    
    <view class="modal-footer">
      <button class="modal-btn cancel-btn" bindtap="closeWishModal">取消</button>
      <button 
        class="modal-btn confirm-btn {{!canSubmitWish ? 'disabled' : ''}}" 
        bindtap="submitWish"
        disabled="{{!canSubmitWish}}"
      >
        许愿
      </button>
    </view>
  </view>
</view>
