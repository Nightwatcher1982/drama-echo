<view class="container">
  <view class="header">
    <view class="title">🔍 用户数据调试</view>
    <view class="subtitle">检查本地和云端用户数据</view>
    <view class="refresh-time">最后刷新: {{lastRefresh}}</view>
  </view>

  <!-- 操作按钮 -->
  <view class="actions">
    <button class="btn-primary" bindtap="onRefresh">🔄 刷新数据</button>
    <button class="btn-warning" bindtap="clearLocalData">🧹 清理本地</button>
    <button class="btn-success" bindtap="reLogin">🔐 重新登录</button>
  </view>
  
    <!-- 紧急操作 -->
    <view class="emergency-actions">
      <button class="btn-info" bindtap="recoverRealNickname">🔍 恢复真实昵称</button>
      <button class="btn-warning" bindtap="emergencyDataFix">🚨 紧急修复</button>
      <button class="btn-danger" bindtap="forceResetUserInfo">⚠️ 强制重置</button>
    </view>

  <!-- OpenID 信息 -->
  <view class="section">
    <view class="section-title">👤 用户标识</view>
    <view class="info-item">
      <text class="label">OpenID:</text>
      <text class="value">{{openId || '未获取'}}</text>
    </view>
  </view>

  <!-- 本地用户信息 -->
  <view class="section">
    <view class="section-title">
      📱 本地用户信息
      <button class="copy-btn" data-type="local" bindtap="copyData">复制</button>
    </view>
    
    <view wx:if="{{userProfile}}">
      <view class="info-item">
        <text class="label">昵称:</text>
        <text class="value">{{userProfile.nickName || '未设置'}}</text>
      </view>
      
      <view class="info-item">
        <text class="label">头像:</text>
        <view class="avatar-info">
          <image class="avatar" src="{{userProfile.avatarUrl}}" mode="aspectFill" wx:if="{{userProfile.avatarUrl}}"></image>
          <view class="avatar-url">{{userProfile.avatarUrl || '未设置'}}</view>
        </view>
      </view>
      
      <view class="info-item">
        <text class="label">是否自定义:</text>
        <text class="value">{{userProfile.isCustomized ? '是' : '否'}}</text>
      </view>
      
      <view class="info-item">
        <text class="label">是否微信默认:</text>
        <text class="value">{{userProfile.isWechatDefault ? '是' : '否'}}</text>
      </view>
      
      <view class="info-item">
        <text class="label">授权时间:</text>
        <text class="value">{{userProfile.authTime || '未记录'}}</text>
      </view>
      
      <view class="info-item">
        <text class="label">自定义时间:</text>
        <text class="value">{{userProfile.customizedTime || '未自定义'}}</text>
      </view>
    </view>
    
    <view wx:else class="no-data">
      <text>📭 暂无本地用户信息</text>
    </view>
  </view>

  <!-- 云端用户数据 -->
  <view class="section">
    <view class="section-title">
      ☁️ 云端用户数据
      <button class="copy-btn" data-type="cloud" bindtap="copyData">复制</button>
    </view>
    
    <view wx:if="{{cloudUserData}}">
      <view wx:if="{{cloudUserData.userInfo}}">
        <view class="info-item">
          <text class="label">昵称:</text>
          <text class="value">{{cloudUserData.userInfo.nickName || '未设置'}}</text>
        </view>
        
        <view class="info-item">
          <text class="label">头像:</text>
          <view class="avatar-info">
            <image class="avatar" src="{{cloudUserData.userInfo.avatarUrl}}" mode="aspectFill" wx:if="{{cloudUserData.userInfo.avatarUrl}}"></image>
            <view class="avatar-url">{{cloudUserData.userInfo.avatarUrl || '未设置'}}</view>
          </view>
        </view>
        
        <view class="info-item">
          <text class="label">创建时间:</text>
          <text class="value">{{cloudUserData.userInfo.createTime || '未记录'}}</text>
        </view>
        
        <view class="info-item">
          <text class="label">最后活跃:</text>
          <text class="value">{{cloudUserData.userInfo.lastActiveTime || '未记录'}}</text>
        </view>
      </view>
      
      <view class="data-preview">
        <text class="label">完整数据结构:</text>
        <text class="json-data">{{cloudUserData}}</text>
      </view>
    </view>
    
    <view wx:else class="no-data">
      <text>📭 暂无云端用户数据</text>
      <button class="btn-secondary" bindtap="loadCloudData">重新加载</button>
    </view>
  </view>
</view>
