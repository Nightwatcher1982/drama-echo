<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="header">
    <view class="title">ğŸ“Š æ•°æ®ç®¡ç†ä¸­å¿ƒ</view>
    <view class="subtitle">ç”¨æˆ·è´­ä¹°è®°å½• & ç²‰ä¸æ‰“æ¦œç»Ÿè®¡</view>
  </view>

  <!-- ç®¡ç†å‘˜éªŒè¯ -->
  <view class="auth-section" wx:if="{{!isAuthed}}">
    <view class="auth-title">ç®¡ç†å‘˜èº«ä»½éªŒè¯</view>
    <input class="auth-input" type="password" placeholder="è¯·è¾“å…¥ç®¡ç†å¯†ç " value="{{adminPassword}}" bindinput="onPasswordInput" />
    <button class="btn-primary" bindtap="authenticate">éªŒè¯èº«ä»½</button>
  </view>

  <!-- ä¸»é¢æ¿ -->
  <view wx:if="{{isAuthed}}">
    <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
    <view class="stats-section">
      <view class="section-title">ğŸ“ˆ æ•°æ®æ¦‚è§ˆ</view>
      <view class="stats-grid">
        <view class="stat-card">
          <view class="stat-number">{{salesStats.totalPurchases}}</view>
          <view class="stat-label">æ€»è´­ä¹°æ¬¡æ•°</view>
        </view>
        <view class="stat-card">
          <view class="stat-number">Â¥{{formatAmount(salesStats.totalSales)}}</view>
          <view class="stat-label">æ€»é”€å”®é¢</view>
        </view>
        <view class="stat-card">
          <view class="stat-number">{{salesStats.todayPurchases}}</view>
          <view class="stat-label">ä»Šæ—¥è´­ä¹°</view>
        </view>
        <view class="stat-card">
          <view class="stat-number">{{userStats.purchasingUsers}}</view>
          <view class="stat-label">è´­ä¹°ç”¨æˆ·æ•°</view>
        </view>
        <view class="stat-card">
          <view class="stat-number">{{userStats.conversionRate}}%</view>
          <view class="stat-label">è½¬åŒ–ç‡</view>
        </view>
        <view class="stat-card">
          <view class="stat-number">Â¥{{formatAmount(salesStats.averageOrderValue)}}</view>
          <view class="stat-label">å¹³å‡å®¢å•ä»·</view>
        </view>
      </view>
    </view>

    <!-- æ ‡ç­¾é¡µ -->
    <view class="tabs">
      <view class="tab {{currentTab === 'purchaseRecords' ? 'active' : ''}}" 
            bindtap="switchTab" data-tab="purchaseRecords">
        ğŸ’° è´­ä¹°è®°å½•
      </view>
      <view class="tab {{currentTab === 'fanRankings' ? 'active' : ''}}" 
            bindtap="switchTab" data-tab="fanRankings">
        ğŸ† ç²‰ä¸æ‰“æ¦œ
      </view>
      <view class="tab {{currentTab === 'voicePackSales' ? 'active' : ''}}" 
            bindtap="switchTab" data-tab="voicePackSales">
        ğŸ“Š é”€å”®æ˜ç»†
      </view>
    </view>

    <!-- è´­ä¹°è®°å½• -->
    <view wx:if="{{currentTab === 'purchaseRecords'}}" class="content-section">
      <view class="section-header">
        <view class="section-title">ğŸ’° ç”¨æˆ·è´­ä¹°è®°å½•</view>
        <button class="btn-refresh" bindtap="refreshData">ğŸ”„ åˆ·æ–°</button>
      </view>
      
      <view class="records-list">
        <view wx:for="{{purchaseRecords}}" wx:key="_id" class="record-item">
          <view class="record-header">
            <view class="user-info">
              <view class="user-name">{{item.userNickName}}</view>
              <view class="user-id">{{item.userId}}</view>
            </view>
            <view class="record-amount">Â¥{{formatAmount(item.amount)}}</view>
          </view>
          
          <view class="record-content">
            <view class="pack-info">
              <view class="pack-name">{{item.packName}}</view>
              <view class="actor-name">æ¼”å‘˜ï¼š{{item.actorName}}</view>
            </view>
            <view class="record-status status-{{item.status}}">
              {{item.status === 'completed' ? 'å·²å®Œæˆ' : item.status === 'pending' ? 'å¾…å¤„ç†' : 'å·²é€€æ¬¾'}}
            </view>
          </view>
          
          <view class="record-footer">
            <view class="purchase-time">{{formatTime(item.purchaseTime)}}</view>
            <view class="purchase-details">
              <view class="purchase-type">{{item.purchaseType === 'package' ? 'æ•´åŒ…è´­ä¹°' : 'å•æ›²è´­ä¹°'}}</view>
              <view class="purchase-count" wx:if="{{item.purchaseCount > 1}}">è´­ä¹° {{item.purchaseCount}} ä»½</view>
            </view>
          </view>
        </view>
        
        <!-- ç©ºçŠ¶æ€ -->
        <view wx:if="{{purchaseRecords.length === 0 && !loading}}" class="empty-state">
          <view class="empty-icon">ğŸ“‹</view>
          <view class="empty-text">æš‚æ— è´­ä¹°è®°å½•</view>
        </view>
        
        <!-- åŠ è½½æ›´å¤š -->
        <view wx:if="{{purchasePage < purchaseTotalPages}}" class="load-more" bindtap="loadMorePurchases">
          <text wx:if="{{!loading}}">åŠ è½½æ›´å¤š</text>
          <text wx:else>åŠ è½½ä¸­...</text>
        </view>
      </view>
    </view>

    <!-- ç²‰ä¸æ‰“æ¦œ -->
    <view wx:if="{{currentTab === 'fanRankings'}}" class="content-section">
      <view class="section-header">
        <view class="section-title">ğŸ† ç²‰ä¸æ‰“æ¦œç»Ÿè®¡</view>
        <view class="header-actions">
          <picker mode="selector" range="{{actors}}" range-key="name" bindchange="onActorChange">
            <view class="actor-picker">{{selectedActorName || 'é€‰æ‹©æ¼”å‘˜'}}</view>
          </picker>
          <button class="btn-refresh" bindtap="refreshData">ğŸ”„ åˆ·æ–°</button>
        </view>
      </view>
      
      <view class="rankings-list">
        <view wx:for="{{fanRankings}}" wx:key="_id" class="ranking-item">
          <view class="rank-number rank-{{item.rank}}">
            <text wx:if="{{item.rank === 1}}">ğŸ¥‡</text>
            <text wx:elif="{{item.rank === 2}}">ğŸ¥ˆ</text>
            <text wx:elif="{{item.rank === 3}}">ğŸ¥‰</text>
            <text wx:else>{{item.rank}}</text>
          </view>
          
          <view class="fan-info">
            <view class="fan-name">{{item.userNickName}}</view>
            <view class="fan-stats">
              <text class="purchase-count">è´­ä¹° {{item.purchaseCount}} ä¸ª</text>
              <text class="total-spent">æ¶ˆè´¹ Â¥{{formatAmount(item.totalSpent)}}</text>
            </view>
          </view>
          
          <view class="fan-level">
            <view class="level-text">{{item.level}}</view>
            <view class="star-level">
              <text wx:for="{{item.starCount}}" wx:key="*this">â­</text>
            </view>
          </view>
        </view>
        
        <!-- ç©ºçŠ¶æ€ -->
        <view wx:if="{{fanRankings.length === 0 && !loading}}" class="empty-state">
          <view class="empty-icon">ğŸ†</view>
          <view class="empty-text">æš‚æ— æ‰“æ¦œæ•°æ®</view>
        </view>
        
        <!-- åŠ è½½æ›´å¤š -->
        <view wx:if="{{rankingPage < rankingTotalPages}}" class="load-more" bindtap="loadMoreRankings">
          <text wx:if="{{!loading}}">åŠ è½½æ›´å¤š</text>
          <text wx:else>åŠ è½½ä¸­...</text>
        </view>
      </view>
    </view>

    <!-- è¯­éŸ³åŒ…é”€å”®æ˜ç»† -->
    <view wx:if="{{currentTab === 'voicePackSales'}}" class="content-section">
      <view class="section-header">
        <view class="section-title">ğŸ“Š è¯­éŸ³åŒ…é”€å”®æ˜ç»†</view>
        <button class="btn-refresh" bindtap="refreshData">ğŸ”„ åˆ·æ–°</button>
      </view>
      
      <view class="sales-list">
        <view wx:for="{{voicePackSales}}" wx:key="_id" class="sales-item">
          <view class="sales-header">
            <view class="pack-info">
              <view class="pack-name">{{item.packName}}</view>
              <view class="actor-name">æ¼”å‘˜ï¼š{{item.actorName}}</view>
            </view>
            <view class="sales-rank">
              <view class="rank-number">#{{index + 1}}</view>
            </view>
          </view>
          
          <view class="sales-stats">
            <view class="stat-row">
              <view class="stat-item">
                <view class="stat-label">å®šä»·</view>
                <view class="stat-value">Â¥{{formatAmount(item.price)}}</view>
              </view>
              <view class="stat-item">
                <view class="stat-label">é”€é‡</view>
                <view class="stat-value">{{item.totalSales}} æ¬¡</view>
              </view>
              <view class="stat-item">
                <view class="stat-label">æ”¶å…¥</view>
                <view class="stat-value">Â¥{{formatAmount(item.totalRevenue)}}</view>
              </view>
            </view>
            
            <view class="stat-row">
              <view class="stat-item">
                <view class="stat-label">è´­ä¹°äººæ•°</view>
                <view class="stat-value">{{item.purchaseCount}} äºº</view>
              </view>
              <view class="stat-item">
                <view class="stat-label">æœ€åé”€å”®</view>
                <view class="stat-value">{{formatTime(item.lastSaleTime)}}</view>
              </view>
              <view class="stat-item">
                <view class="stat-label">çŠ¶æ€</view>
                <view class="stat-value status-{{item.status}}">
                  {{item.status === 'active' ? 'ä¸Šæ¶' : 'ä¸‹æ¶'}}
                </view>
              </view>
            </view>
          </view>
          
          <view class="sales-footer">
            <view class="create-time">åˆ›å»ºæ—¶é—´ï¼š{{formatTime(item.createTime)}}</view>
            <view class="conversion-rate" wx:if="{{item.purchaseCount > 0}}">
              è½¬åŒ–ç‡ï¼š{{Math.round((item.totalSales / item.purchaseCount) * 100)}}%
            </view>
          </view>
        </view>
        
        <!-- ç©ºçŠ¶æ€ -->
        <view wx:if="{{voicePackSales.length === 0 && !loading}}" class="empty-state">
          <view class="empty-icon">ğŸ“Š</view>
          <view class="empty-text">æš‚æ— é”€å”®æ•°æ®</view>
        </view>
        
        <!-- åŠ è½½æ›´å¤š -->
        <view wx:if="{{salesPage < salesTotalPages}}" class="load-more" bindtap="loadMoreSales">
          <text wx:if="{{!loading}}">åŠ è½½æ›´å¤š</text>
          <text wx:else>åŠ è½½ä¸­...</text>
        </view>
      </view>
    </view>

    <!-- é€€å‡ºç™»å½• -->
    <view class="logout-section">
      <button class="btn-logout" bindtap="logout">é€€å‡ºç™»å½•</button>
    </view>
  </view>
</view>
