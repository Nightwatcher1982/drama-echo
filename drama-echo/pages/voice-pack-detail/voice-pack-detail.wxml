<!-- è¯­éŸ³åŒ…è¯¦æƒ…é¡µ -->
<view class="container">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="top-bar">
    <view class="nav-bar">
      <view class="nav-title"></view>
    </view>
  </view>

  <!-- è¯­éŸ³åŒ…å›¾ç‰‡å±•ç¤ºåŒºåŸŸ -->
  <view class="photo-section">
    <swiper 
      class="photo-swiper" 
      indicator-dots="{{packInfo.images && packInfo.images.length > 1}}" 
      autoplay="{{packInfo.images && packInfo.images.length > 1}}" 
      circular="{{packInfo.images && packInfo.images.length > 1}}"
      interval="3000"
      duration="500"
      indicator-color="rgba(255, 255, 255, 0.5)"
      indicator-active-color="#ffffff"
      bindchange="onSwiperChange"
    >
      <swiper-item wx:for="{{packInfo.images}}" wx:key="index">
        <image 
          src="{{item}}" 
          class="photo-image" 
          mode="aspectFill"
          bindtap="previewPhoto"
          data-index="{{index}}"
        />
      </swiper-item>
    </swiper>
    
    <!-- å›¾ç‰‡æ•°é‡æç¤º -->
    <view wx:if="{{packInfo.images && packInfo.images.length > 1}}" class="image-count-indicator">
      <text class="count-text">{{currentImageIndex + 1}}/{{packInfo.images.length}}</text>
    </view>
  </view>


  <!-- è¯­éŸ³åˆ—è¡¨ -->
  <view class="voice-list-section">
    <view class="voice-list">
      <view 
        class="voice-item {{currentPlaying === index ? 'playing' : ''}}" 
        wx:for="{{packInfo.voices}}" 
        wx:key="index"
        data-index="{{index}}"
      >
        <view class="voice-content">
          <view class="voice-title">{{item.title}}</view>
          <view class="voice-meta">
            <text wx:if="{{item.subtitle}}" class="voice-subtitle">{{item.subtitle}}</text>
          </view>
        </view>
        
        <view class="voice-action">
          <view 
            class="play-btn {{currentPlaying === index ? 'playing' : ''}}" 
            bindtap="previewVoice"
            data-index="{{index}}"
          >
            <text class="play-icon">{{currentPlaying === index ? 'â¸' : 'â–¶'}}</text>
          </view>
        </view>
        
        <!-- æ’­æ”¾è¿›åº¦æ¡ -->
        <view class="progress-bar" wx:if="{{currentPlaying === index}}">
          <view class="progress" style="width: {{playProgress}}%"></view>
        </view>
      </view>
    </view>
  </view>


  <!-- èŠ±çµ®è§†é¢‘é¢„è§ˆ (å¦‚æœæœ‰èŠ±çµ®è§†é¢‘) -->
  <view class="bonus-section" wx:if="{{packInfo.bonusVideoUrl}}">
    <view class="section-title">
      <text class="title-icon">ğŸ¬</text>
      <text class="title-text">ç‹¬å®¶èŠ±çµ®</text>
    </view>
    
    <view class="video-preview" bindtap="playBonusVideo">
      <image src="{{packInfo.bonusVideoThumb || 'https://picsum.photos/300/200?random=1'}}" class="video-thumb" mode="aspectFill" />
      <view class="play-overlay">
        <text class="play-icon">â–¶</text>
      </view>
      <view class="video-info">
        <text class="video-title">{{packInfo.bonusVideoTitle || 'èŠ±çµ®è§†é¢‘'}}</text>
        <text class="video-duration">{{packInfo.bonusVideoDuration || 'æœªçŸ¥æ—¶é•¿'}}</text>
      </view>
    </view>
  </view>

  <!-- æ‰“æ¦œå¤è´­åŒºåŸŸ -->
  <view class="support-section" wx:if="{{packInfo.packagePurchased}}">
    <view class="support-card">
      <view class="support-info">
        <view class="support-title">ä¸º{{packInfo.actorName}}æ‰“æ¦œ</view>
        <view class="support-desc">æ”¯æŒä½ å–œæ¬¢çš„æ¼”å‘˜ï¼Œè®©TAåœ¨æ’è¡Œæ¦œä¸Šæ›´é—ªè€€ï¼</view>
        <view class="support-count">å½“å‰å·²æ”¯æŒï¼š{{userPurchaseCount}}ä»½</view>
      </view>
      
      <view class="support-action">
        <view class="support-btn" bindtap="showRepurchaseModal">
          <text class="btn-icon">ğŸ’</text>
          <text class="btn-text">æ‰“æ¦œå¤è´­</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å¤è´­æ•°é‡é€‰æ‹©å¼¹çª— -->
  <view class="repurchase-modal" wx:if="{{showRepurchaseModal}}" catchtouchmove="preventTouchMove">
    <view class="modal-mask" bindtap="hideRepurchaseModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <view class="modal-title">é€‰æ‹©å¤è´­æ•°é‡</view>
        <view class="modal-close" bindtap="hideRepurchaseModal">Ã—</view>
      </view>
      
      <view class="modal-body">
        <view class="pack-info">
          <image src="{{packInfo.icon}}" class="pack-icon" mode="aspectFill" />
          <view class="pack-details">
            <view class="pack-name">{{packInfo.name}}</view>
            <view class="pack-price">Â¥{{packInfo.formattedPrice}}</view>
          </view>
        </view>
        
        <view class="quantity-selector">
          <view class="quantity-label">è´­ä¹°æ•°é‡</view>
          <view class="quantity-controls">
            <view class="quantity-btn" bindtap="decreaseQuantity">-</view>
            <view class="quantity-display">{{repurchaseQuantity}}</view>
            <view class="quantity-btn" bindtap="increaseQuantity">+</view>
          </view>
        </view>
        
        <view class="total-price">
          <text class="total-label">æ€»è®¡ï¼š</text>
          <text class="total-amount">Â¥{{totalPrice}}</text>
        </view>
      </view>
      
      <view class="modal-footer">
        <view class="modal-btn cancel-btn" bindtap="hideRepurchaseModal">å–æ¶ˆ</view>
        <view class="modal-btn confirm-btn" bindtap="confirmRepurchase">ç¡®è®¤è´­ä¹°</view>
      </view>
    </view>
  </view>
</view>

<!-- éŸ³é¢‘æ’­æ”¾å™¨ç»„ä»¶ -->
<audio-player
  show="{{showAudioPlayer}}"
  audioUrl="{{currentAudioUrl}}"
  fileName="{{currentAudioFileName}}"
  coverImage="{{packInfo.images && packInfo.images[0] ? packInfo.images[0] : ''}}"
  coverImages="{{packInfo.images || []}}"
  playlist="{{packInfo.voices}}"
  currentIndex="{{currentPlaying}}"
  bind:close="closeAudioPlayer">
</audio-player>

<!-- è´­ä¹°ç¡®è®¤å¼¹çª—å·²ç§»é™¤ -->
