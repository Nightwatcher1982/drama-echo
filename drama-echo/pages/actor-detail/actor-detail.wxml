<!--演员详情页面-->
<view class="container">
  <!-- 加载状态 -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <view class="loading-text">加载中...</view>
  </view>

  <view wx:else>
    <!-- 演员封面照片 -->
    <view class="actor-cover-section">
      <view wx:if="{{actor.coverImageUrl}}" class="actor-cover-image">
        <image src="{{actor.coverImageUrl}}" mode="aspectFill" class="cover-image"></image>
        <view class="cover-overlay"></view>
      </view>
      <view wx:else class="actor-cover-placeholder">
        <view class="placeholder-icon">{{actor.avatar}}</view>
        <view class="placeholder-text">{{actor.name}}</view>
      </view>
    </view>

    <!-- 粉丝排行榜 -->
    <view class="ranking-section">
      <view class="section-header">
        <view class="section-title">👑 粉丝支持榜</view>
      </view>
      <view class="ranking-list">
        <view wx:for="{{fanRanking}}" wx:key="_id" class="ranking-item rank-{{item.rank}}">
          <view class="rank-number">
            <text wx:if="{{item.rank === 1}}">🥇</text>
            <text wx:elif="{{item.rank === 2}}">🥈</text>
            <text wx:elif="{{item.rank === 3}}">🥉</text>
            <text wx:else>{{item.rank}}</text>
          </view>
          <view class="fan-avatar">
            <image wx:if="{{item.userAvatar}}" src="{{item.userAvatar}}" class="avatar-image" mode="aspectFill"></image>
            <view wx:else class="avatar-placeholder">头像</view>
          </view>
          <view class="fan-info">
            <view class="fan-name">{{item.userNickName}}</view>
            <view class="purchase-count">已收藏 {{item.purchaseCount}} 个专属声音</view>
          </view>
          <view class="support-level">
            <view class="level-text">{{item.level}}</view>
          </view>
        </view>
        
        <!-- 空状态 -->
        <view wx:if="{{fanRanking.length === 0}}" class="empty-ranking">
          <view class="empty-icon">👑</view>
          <view class="empty-text">暂无支持榜，快来成为第一个守护者吧！</view>
        </view>
      </view>
      <view class="header-actions">
        <view class="view-all" bind:tap="viewFullRanking">查看完整榜单 →</view>
      </view>
    </view>
      
      <!-- 奖励说明 -->
      <view class="reward-notice">
        <view class="notice-header">
          <view class="notice-icon">🎁</view>
          <view class="notice-title">月度荣耀活动</view>
        </view>
        <view class="notice-content">
          <view class="notice-text">榜单前三甲粉丝可获得实物礼包</view>
          <view class="notice-details" bind:tap="showRewardDetails">
            <text>查看奖励详情</text>
            <text class="arrow">→</text>
          </view>
        </view>
      </view>

    <!-- 语音包展示 -->
    <view class="voice-packs">
      <view class="section-header">
        <view class="section-title">🎭 精选语音包</view>
      </view>
      <view class="packs-list">
        <view wx:for="{{voicePacks}}" wx:key="_id" 
              class="pack-item-row {{item.isPurchased ? 'purchased' : ''}} {{item.isSelected ? 'selected' : ''}}"
              data-pack-id="{{item._id}}"
              data-price="{{item.price}}"
              data-is-purchased="{{item.isPurchased}}"
              bind:tap="togglePackSelection"
              bind:longpress="goToPackDetail">
          
          <!-- 左侧内容 -->
          <view class="pack-left">
            <view class="pack-icon">{{item.icon}}</view>
            <view class="pack-info">
              <view class="pack-name">{{item.name}}</view>
              <view class="pack-meta">
                <view class="pack-sales">已售 {{item.sales}} 份</view>
                <view class="pack-price" wx:if="{{isVirtualPaymentSupported && item.priceValue}}">
                  <text class="price-number">{{item.priceValue}}</text>
                  <text class="price-unit">个回响</text>
                </view>
              </view>
            </view>
          </view>
          
          <!-- 右侧内容 -->
          <view class="pack-right">
            <view class="pack-buttons">
              <view class="buy-button"
                    data-pack-id="{{item._id}}"
                    data-is-purchased="{{item.isPurchased}}"
                    catch:tap="{{item.isPurchased ? 'goToPackDetail' : 'showPackDetail'}}">
                {{item.isPurchased ? '查看' : '获取'}}
              </view>
            </view>
          </view>
          
          <!-- 标签 -->
          <view wx:if="{{item.isHot && !item.isPurchased}}" class="hot-badge">HOT</view>
          <view wx:if="{{item.isPurchased}}" class="purchased-badge">已拥有</view>
          <view wx:if="{{item.isSelected}}" class="selected-mark">✓</view>
        </view>
      </view>
    </view>

    <!-- 底部操作区域 -->
    <view class="bottom-spacing"></view>
  </view>

  <!-- 语音包详情弹窗 -->
  <view wx:if="{{showPackDetailModal}}" class="modal-overlay" bind:tap="closePackDetail">
    <view class="modal-content" catch:tap="">
      <view class="modal-header">
        <view class="modal-title">{{currentPackDetail.name}}</view>
        <view class="modal-close" bind:tap="closePackDetail">×</view>
      </view>
      
      <view class="modal-body">
        <!-- 套餐内容 -->
        <view class="package-info-section">
          <view class="package-title">
            <text class="title-icon">🎁</text>
            <text class="title-text">套餐内容</text>
          </view>
          
          <view class="package-includes">
            <view class="include-item">
              <text class="item-icon">🎵</text>
              <text class="item-text">全部{{currentPackDetail.voiceCount || 0}}条语音</text>
            </view>
            <view class="include-item" wx:if="{{currentPackDetail.images && currentPackDetail.images.length > 0}}">
              <text class="item-icon">📸</text>
              <text class="item-text">高清写真图包 ({{currentPackDetail.images.length}}张)</text>
            </view>
            <view class="include-item" wx:if="{{currentPackDetail.bonusVideoUrl}}">
              <text class="item-icon">🎬</text>
              <text class="item-text">独家花絮视频</text>
            </view>
          </view>
        </view>
        
        
        <!-- 详细信息 -->
        <view class="detail-info-section" wx:if="{{currentPackDetail.description}}">
          <view class="pack-info-item">
            <text class="info-label">描述：</text>
            <text class="info-value">{{currentPackDetail.description}}</text>
          </view>
        </view>
      </view>
      
      <!-- 版权声明 -->
      <view class="copyright-notice">
        <text class="copyright-text">戏剧回响销售内容（含文字、图片、音视频等）版权归我方所有，受法律保护，未经书面许可，禁止任何形式转载、复制、传播、改编、剪辑，也不得将内容用于商业性销售、盈利或其他侵犯版权的行为。违者将依法追责。</text>
      </view>
      
      <view class="modal-footer">
        <button class="modal-buy-btn" bind:tap="goToPackDetailFromModal">
          {{currentPackDetail.isPurchased ? '进入详情页' : '立即获取'}}
        </button>
      </view>
    </view>
  </view>

  <!-- 语音播放器组件 -->
  <voice-player 
    isOpen="{{showVoicePlayer}}"
    currentPack="{{currentVoicePack}}"
    currentActor="{{actor}}"
    playlist="{{voicePlaylist}}"
    bind:close="closeVoicePlayer">
  </voice-player>

  <!-- 授权弹窗 -->
  <auth-modal 
    show="{{showAuthModal}}" 
    title="完善用户信息"
    subtitle="为了完成语音包购买，需要获取您的用户信息"
    bind:success="onAuthSuccess"
    bind:cancel="onAuthCancel"
    bind:close="onAuthClose">
  </auth-modal>
</view>