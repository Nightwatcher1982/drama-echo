<!--æ¼”å‘˜è¯¦æƒ…é¡µé¢-->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>

  <view wx:else>
    <!-- æ¼”å‘˜å°é¢ç…§ç‰‡ -->
    <view class="actor-cover-section">
      <view wx:if="{{actor.coverImageUrl}}" class="actor-cover-image">
        <image src="{{actor.coverImageUrl}}" mode="aspectFill" class="cover-image"></image>
        <view class="cover-overlay"></view>
      </view>
      <view wx:else class="actor-cover-placeholder">
        <view class="placeholder-icon">{{actor.avatar}}</view>
        <view class="placeholder-text">{{actor.name}}</view>
      </view>
    </view>

    <!-- ç²‰ä¸æ’è¡Œæ¦œ -->
    <view class="ranking-section">
      <view class="section-header">
        <view class="section-title">ğŸ‘‘ ç²‰ä¸æ”¯æŒæ¦œ</view>
      </view>
      <view class="ranking-list">
        <view wx:for="{{fanRanking}}" wx:key="_id" class="ranking-item rank-{{item.rank}}">
          <view class="rank-number">
            <text wx:if="{{item.rank === 1}}">ğŸ¥‡</text>
            <text wx:elif="{{item.rank === 2}}">ğŸ¥ˆ</text>
            <text wx:elif="{{item.rank === 3}}">ğŸ¥‰</text>
            <text wx:else>{{item.rank}}</text>
          </view>
          <view class="fan-avatar">
            <image wx:if="{{item.userAvatar}}" src="{{item.userAvatar}}" class="avatar-image" mode="aspectFill"></image>
            <view wx:else class="avatar-placeholder">å¤´åƒ</view>
          </view>
          <view class="fan-info">
            <view class="fan-name">{{item.userNickName}}</view>
            <view class="purchase-count">å·²æ”¶è— {{item.purchaseCount}} ä¸ªä¸“å±å£°éŸ³</view>
          </view>
          <view class="support-level">
            <view class="level-text">{{item.level}}</view>
          </view>
        </view>
        
        <!-- ç©ºçŠ¶æ€ -->
        <view wx:if="{{fanRanking.length === 0}}" class="empty-ranking">
          <view class="empty-icon">ğŸ‘‘</view>
          <view class="empty-text">æš‚æ— æ”¯æŒæ¦œï¼Œå¿«æ¥æˆä¸ºç¬¬ä¸€ä¸ªå®ˆæŠ¤è€…å§ï¼</view>
        </view>
      </view>
        <view class="header-actions">
          <view class="view-all" bind:tap="viewFullRanking">æŸ¥çœ‹å®Œæ•´æ¦œå• â†’</view>
        </view>
    </view>
      
      <!-- å¥–åŠ±è¯´æ˜ -->
      <view class="reward-notice">
        <view class="notice-header">
          <view class="notice-title">æœˆåº¦è£è€€æ´»åŠ¨</view>
        </view>
        <view class="notice-content">
          <view class="notice-text">æ¦œå•å‰ä¸‰ç”²ç”¨æˆ·å¯è·å¾—å®ç‰©ç¤¼åŒ…ï¼Œç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…ï¼Œäº†è§£æ‚¨çš„ä¸“å±ç¦åˆ©ã€‚</view>
          <view class="notice-details" bind:tap="showRewardDetails">
            <text>æŸ¥çœ‹å¥–åŠ±è¯¦æƒ…</text>
            <text class="arrow">â†’</text>
          </view>
        </view>
      </view>

    <!-- è¯­éŸ³åŒ…å±•ç¤º -->
    <view class="voice-packs">
      <view class="section-header">
        <view class="section-title">ğŸ­ ç²¾é€‰è¯­éŸ³åŒ…</view>
      </view>
      <view class="packs-list">
        <view wx:for="{{voicePacks}}" wx:key="_id" 
              class="pack-item-row {{item.isPurchased ? 'purchased' : ''}} {{item.isSelected ? 'selected' : ''}}"
              data-pack-id="{{item._id}}"
              data-price="{{item.price}}"
              data-is-purchased="{{item.isPurchased}}"
              bind:tap="togglePackSelection"
              bind:longpress="goToPackDetail">
          
          <!-- å·¦ä¾§å†…å®¹ -->
          <view class="pack-left">
            <view class="pack-icon">{{item.icon}}</view>
            <view class="pack-info">
              <view class="pack-name">{{item.name}}</view>
              <view class="pack-sales">å·²å”® {{item.sales}} ä»½</view>
            </view>
          </view>
          
          <!-- å³ä¾§å†…å®¹ -->
          <view class="pack-right">
            <view class="pack-price">Â¥{{item.formattedPrice}}</view>
            <view class="pack-buttons">
              <view class="buy-button"
                    data-pack-id="{{item._id}}"
                    data-is-purchased="{{item.isPurchased}}"
                    catch:tap="{{item.isPurchased ? 'goToPackDetail' : 'showPackDetail'}}">
                {{item.isPurchased ? 'â–¶ï¸ æ’­æ”¾' : 'ğŸ’° è´­ä¹°'}}
              </view>
              <button wx:if="{{item.isPurchased}}" 
                      class="share-button"
                      open-type="share"
                      data-pack-id="{{item._id}}"
                      data-pack-name="{{item.name}}"
                      data-pack-sales="{{item.sales}}"
                      bind:tap="setShareContent">
                ğŸ“¤ åˆ†äº«
              </button>
            </view>
          </view>
          
          <!-- æ ‡ç­¾ -->
          <view wx:if="{{item.isHot && !item.isPurchased}}" class="hot-badge">HOT</view>
          <view wx:if="{{item.isPurchased}}" class="purchased-badge">å·²æ‹¥æœ‰</view>
          <view wx:if="{{item.isSelected}}" class="selected-mark">âœ“</view>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨æ“ä½œåŒºåŸŸ -->
    <view class="bottom-spacing"></view>
  </view>

  <!-- è¯­éŸ³åŒ…è¯¦æƒ…å¼¹çª— -->
  <view wx:if="{{showPackDetailModal}}" class="modal-overlay" bind:tap="closePackDetail">
    <view class="modal-content" catch:tap="">
      <view class="modal-header">
        <view class="modal-title">{{currentPackDetail.name}}</view>
        <view class="modal-close" bind:tap="closePackDetail">Ã—</view>
      </view>
      
      <view class="modal-body">
        <!-- å¥—é¤å†…å®¹ -->
        <view class="package-info-section">
          <view class="package-title">
            <text class="title-icon">ğŸ</text>
            <text class="title-text">å¥—é¤å†…å®¹</text>
          </view>
          
          <view class="package-includes">
            <view class="include-item">
              <text class="item-icon">ğŸµ</text>
              <text class="item-text">å…¨éƒ¨{{currentPackDetail.voiceCount || 0}}æ¡è¯­éŸ³</text>
            </view>
            <view class="include-item" wx:if="{{currentPackDetail.images && currentPackDetail.images.length > 0}}">
              <text class="item-icon">ğŸ“¸</text>
              <text class="item-text">é«˜æ¸…å†™çœŸå›¾åŒ… ({{currentPackDetail.images.length}}å¼ )</text>
            </view>
            <view class="include-item" wx:if="{{currentPackDetail.bonusVideoUrl}}">
              <text class="item-icon">ğŸ¬</text>
              <text class="item-text">ç‹¬å®¶èŠ±çµ®è§†é¢‘</text>
            </view>
          </view>
        </view>
        
        <!-- ä»·æ ¼ä¿¡æ¯ -->
        <view class="price-info-section">
          <view class="price-item">
            <text class="price-label">å¥—é¤ä»·æ ¼ï¼š</text>
            <text class="price-value">Â¥{{(currentPackDetail.packagePrice || 0) / 100}}</text>
          </view>
          <view class="price-item" wx:if="{{currentPackDetail.originalPrice && currentPackDetail.originalPrice > currentPackDetail.packagePrice}}">
            <text class="price-label">åŸä»·ï¼š</text>
            <text class="original-price">Â¥{{(currentPackDetail.originalPrice || 0) / 100}}</text>
          </view>
          <view class="save-info" wx:if="{{currentPackDetail.saveAmount && currentPackDetail.saveAmount > 0}}">
            <text class="save-text">èŠ‚çœ Â¥{{(currentPackDetail.saveAmount || 0) / 100}}</text>
          </view>
        </view>
        
        <!-- è¯¦ç»†ä¿¡æ¯ -->
        <view class="detail-info-section">
          <view class="pack-info-item">
            <text class="info-label">æ€»æ—¶é•¿ï¼š</text>
            <text class="info-value">{{currentPackDetail.totalDuration || 'æœªçŸ¥'}}</text>
          </view>
          
          <view class="pack-info-item">
            <text class="info-label">åˆ†ç±»ï¼š</text>
            <text class="info-value">{{currentPackDetail.category || 'æœªåˆ†ç±»'}}</text>
          </view>
          
          <view class="pack-info-item" wx:if="{{currentPackDetail.description}}">
            <text class="info-label">æè¿°ï¼š</text>
            <text class="info-value">{{currentPackDetail.description}}</text>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="modal-buy-btn" bind:tap="goToPackDetailFromModal">
          {{currentPackDetail.isPurchased ? 'è¿›å…¥è¯¦æƒ…é¡µ' : 'ç«‹å³è´­ä¹°'}}
        </button>
      </view>
    </view>
  </view>

  <!-- è¯­éŸ³æ’­æ”¾å™¨ç»„ä»¶ -->
  <voice-player 
    isOpen="{{showVoicePlayer}}"
    currentPack="{{currentVoicePack}}"
    currentActor="{{actor}}"
    playlist="{{voicePlaylist}}"
    bind:close="closeVoicePlayer">
  </voice-player>
</view>