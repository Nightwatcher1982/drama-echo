<!--演员详情页面-->
<view class="container">
  <!-- 加载状态 -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <view class="loading-text">加载中...</view>
  </view>

  <view wx:else>
    <!-- 演员封面照片 -->
    <view class="actor-cover-section">
      <view wx:if="{{actor.coverImageUrl}}" class="actor-cover-image">
        <image src="{{actor.coverImageUrl}}" mode="aspectFill" class="cover-image"></image>
        <view class="cover-overlay"></view>
      </view>
      <view wx:else class="actor-cover-placeholder">
        <view class="placeholder-icon">{{actor.avatar}}</view>
        <view class="placeholder-text">{{actor.name}}</view>
      </view>
    </view>

    <!-- 粉丝排行榜 -->
    <view class="ranking-section">
      <view class="section-header">
        <view class="section-title">👑 粉丝支持榜</view>
      </view>
      <view class="ranking-list">
        <view wx:for="{{fanRanking}}" wx:key="_id" class="ranking-item rank-{{item.rank}}">
          <view class="rank-number">
            <text wx:if="{{item.rank === 1}}">🥇</text>
            <text wx:elif="{{item.rank === 2}}">🥈</text>
            <text wx:elif="{{item.rank === 3}}">🥉</text>
            <text wx:else>{{item.rank}}</text>
          </view>
          <view class="fan-avatar">
            <image wx:if="{{item.userAvatar}}" src="{{item.userAvatar}}" class="avatar-image" mode="aspectFill"></image>
            <view wx:else class="avatar-placeholder">头像</view>
          </view>
          <view class="fan-info">
            <view class="fan-name">{{item.userNickName}}</view>
            <view class="purchase-count">已收藏 {{item.purchaseCount}} 个专属声音</view>
          </view>
          <view class="support-level">
            <view class="level-text">{{item.level}}</view>
          </view>
        </view>
        
        <!-- 空状态 -->
        <view wx:if="{{fanRanking.length === 0}}" class="empty-ranking">
          <view class="empty-icon">👑</view>
          <view class="empty-text">暂无支持榜，快来成为第一个守护者吧！</view>
        </view>
      </view>
        <view class="header-actions">
          <view class="view-all" bind:tap="viewFullRanking">查看完整榜单 →</view>
        </view>
    </view>
      
      <!-- 奖励说明 -->
      <view class="reward-notice">
        <view class="notice-header">
          <view class="notice-title">月度荣耀活动</view>
        </view>
        <view class="notice-content">
          <view class="notice-text">榜单前三甲用户可获得实物礼包，点击查看详情，了解您的专属福利。</view>
          <view class="notice-details" bind:tap="showRewardDetails">
            <text>查看奖励详情</text>
            <text class="arrow">→</text>
          </view>
        </view>
      </view>

    <!-- 语音包展示 -->
    <view class="voice-packs">
      <view class="section-header">
        <view class="section-title">🎭 精选语音包</view>
      </view>
      <view class="packs-list">
        <view wx:for="{{voicePacks}}" wx:key="_id" 
              class="pack-item-row {{item.isPurchased ? 'purchased' : ''}} {{item.isSelected ? 'selected' : ''}}"
              data-pack-id="{{item._id}}"
              data-price="{{item.price}}"
              data-is-purchased="{{item.isPurchased}}"
              bind:tap="togglePackSelection"
              bind:longpress="goToPackDetail">
          
          <!-- 左侧内容 -->
          <view class="pack-left">
            <view class="pack-icon">{{item.icon}}</view>
            <view class="pack-info">
              <view class="pack-name">{{item.name}}</view>
              <view class="pack-sales">已售 {{item.sales}} 份</view>
            </view>
          </view>
          
          <!-- 右侧内容 -->
          <view class="pack-right">
            <view class="pack-price">¥{{item.formattedPrice}}</view>
            <view class="pack-buttons">
              <view class="buy-button"
                    data-pack-id="{{item._id}}"
                    data-is-purchased="{{item.isPurchased}}"
                    catch:tap="{{item.isPurchased ? 'goToPackDetail' : 'showPackDetail'}}">
                {{item.isPurchased ? '▶️ 播放' : '💰 购买'}}
              </view>
              <button wx:if="{{item.isPurchased}}" 
                      class="share-button"
                      open-type="share"
                      data-pack-id="{{item._id}}"
                      data-pack-name="{{item.name}}"
                      data-pack-sales="{{item.sales}}"
                      bind:tap="setShareContent">
                📤 分享
              </button>
            </view>
          </view>
          
          <!-- 标签 -->
          <view wx:if="{{item.isHot && !item.isPurchased}}" class="hot-badge">HOT</view>
          <view wx:if="{{item.isPurchased}}" class="purchased-badge">已拥有</view>
          <view wx:if="{{item.isSelected}}" class="selected-mark">✓</view>
        </view>
      </view>
    </view>

    <!-- 底部操作区域 -->
    <view class="bottom-spacing"></view>
  </view>

  <!-- 语音包详情弹窗 -->
  <view wx:if="{{showPackDetailModal}}" class="modal-overlay" bind:tap="closePackDetail">
    <view class="modal-content" catch:tap="">
      <view class="modal-header">
        <view class="modal-title">{{currentPackDetail.name}}</view>
        <view class="modal-close" bind:tap="closePackDetail">×</view>
      </view>
      
      <view class="modal-body">
        <!-- 套餐内容 -->
        <view class="package-info-section">
          <view class="package-title">
            <text class="title-icon">🎁</text>
            <text class="title-text">套餐内容</text>
          </view>
          
          <view class="package-includes">
            <view class="include-item">
              <text class="item-icon">🎵</text>
              <text class="item-text">全部{{currentPackDetail.voiceCount || 0}}条语音</text>
            </view>
            <view class="include-item" wx:if="{{currentPackDetail.images && currentPackDetail.images.length > 0}}">
              <text class="item-icon">📸</text>
              <text class="item-text">高清写真图包 ({{currentPackDetail.images.length}}张)</text>
            </view>
            <view class="include-item" wx:if="{{currentPackDetail.bonusVideoUrl}}">
              <text class="item-icon">🎬</text>
              <text class="item-text">独家花絮视频</text>
            </view>
          </view>
        </view>
        
        <!-- 价格信息 -->
        <view class="price-info-section">
          <view class="price-item">
            <text class="price-label">套餐价格：</text>
            <text class="price-value">¥{{(currentPackDetail.packagePrice || 0) / 100}}</text>
          </view>
          <view class="price-item" wx:if="{{currentPackDetail.originalPrice && currentPackDetail.originalPrice > currentPackDetail.packagePrice}}">
            <text class="price-label">原价：</text>
            <text class="original-price">¥{{(currentPackDetail.originalPrice || 0) / 100}}</text>
          </view>
          <view class="save-info" wx:if="{{currentPackDetail.saveAmount && currentPackDetail.saveAmount > 0}}">
            <text class="save-text">节省 ¥{{(currentPackDetail.saveAmount || 0) / 100}}</text>
          </view>
        </view>
        
        <!-- 详细信息 -->
        <view class="detail-info-section">
          <view class="pack-info-item">
            <text class="info-label">总时长：</text>
            <text class="info-value">{{currentPackDetail.totalDuration || '未知'}}</text>
          </view>
          
          <view class="pack-info-item">
            <text class="info-label">分类：</text>
            <text class="info-value">{{currentPackDetail.category || '未分类'}}</text>
          </view>
          
          <view class="pack-info-item" wx:if="{{currentPackDetail.description}}">
            <text class="info-label">描述：</text>
            <text class="info-value">{{currentPackDetail.description}}</text>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="modal-buy-btn" bind:tap="goToPackDetailFromModal">
          {{currentPackDetail.isPurchased ? '进入详情页' : '立即购买'}}
        </button>
      </view>
    </view>
  </view>

  <!-- 语音播放器组件 -->
  <voice-player 
    isOpen="{{showVoicePlayer}}"
    currentPack="{{currentVoicePack}}"
    currentActor="{{actor}}"
    playlist="{{voicePlaylist}}"
    bind:close="closeVoicePlayer">
  </voice-player>
</view>