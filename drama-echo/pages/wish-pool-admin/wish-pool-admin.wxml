<!--许愿池管理页面-->
<view class="container">
  <!-- 页面标题 -->
  <view class="page-header">
    <view class="page-title">许愿池管理</view>
    <view class="header-actions">
      <button class="btn-refresh" bindtap="refreshData">🔄 刷新</button>
    </view>
  </view>

  <!-- 加载状态 -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <view class="loading-text">加载中...</view>
  </view>

  <view wx:else>
    <!-- 标签页切换 -->
    <view class="tab-container">
      <view class="tab-item {{currentTab === 'list' ? 'active' : ''}}" 
            bindtap="switchTab" data-tab="list">
        许愿列表
      </view>
      <view class="tab-item {{currentTab === 'stats' ? 'active' : ''}}" 
            bindtap="switchTab" data-tab="stats">
        数据统计
      </view>
    </view>

    <!-- 许愿列表 -->
    <view wx:if="{{currentTab === 'list'}}" class="wish-list-container">
      <!-- 搜索框 -->
      <view class="search-container">
        <input class="search-input" 
               placeholder="搜索许愿内容或用户名..." 
               bindinput="onSearchInput"
               value="{{searchKeyword}}" />
      </view>

      <!-- 许愿列表 -->
      <view class="wish-list">
        <view wx:for="{{filteredWishes}}" wx:key="_id" class="wish-item">
          <view class="wish-content" bindtap="viewWishDetail" data-wish="{{item}}">
            <view class="wish-text">{{item.content}}</view>
            <view class="wish-meta">
              <view class="wish-user">用户 {{item.userNickName}}</view>
              <view class="wish-time">🕒 {{item.createTimeFormatted}}</view>
            </view>
          </view>
          <view class="wish-support">
            <view class="support-count {{item.supportCount > 0 ? 'has-support' : 'no-support'}}">
              {{item.supportCount > 0 ? '🔥' : '❄️'}} {{item.supportCount}}
            </view>
            <view class="support-label">助力</view>
          </view>
        </view>
      </view>

      <!-- 空状态 -->
      <view wx:if="{{filteredWishes.length === 0}}" class="empty-state">
        <view class="empty-icon">🎋</view>
        <view class="empty-text">暂无许愿数据</view>
      </view>
    </view>

    <!-- 数据统计 -->
    <view wx:if="{{currentTab === 'stats'}}" class="stats-container">
      <!-- 总体统计 -->
      <view class="stats-section">
        <view class="section-title">总体统计</view>
        <view class="stats-grid">
          <view class="stat-item">
            <view class="stat-number">{{totalWishes}}</view>
            <view class="stat-label">总许愿数</view>
          </view>
          <view class="stat-item">
            <view class="stat-number">{{totalSupports}}</view>
            <view class="stat-label">总助力数</view>
          </view>
          <view class="stat-item">
            <view class="stat-number">{{todayWishes}}</view>
            <view class="stat-label">今日许愿</view>
          </view>
          <view class="stat-item">
            <view class="stat-number">{{todaySupports}}</view>
            <view class="stat-label">今日助力</view>
          </view>
        </view>
      </view>

      <!-- 热门许愿 -->
      <view class="stats-section">
        <view class="section-title">热门许愿 TOP5</view>
        <view class="top-wishes">
          <view wx:for="{{topWishes}}" wx:key="_id" class="top-wish-item">
            <view class="rank-number">{{index + 1}}</view>
            <view class="top-wish-content">
              <view class="top-wish-text">{{item.content}}</view>
              <view class="top-wish-meta">
                <text class="top-wish-user">{{item.userNickName}}</text>
                <text class="top-wish-time">{{item.createTimeFormatted}}</text>
              </view>
            </view>
            <view class="top-wish-support">
              <view class="support-count">{{item.supportCount}}</view>
              <view class="support-label">助力</view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>
