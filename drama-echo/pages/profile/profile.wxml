<view class="container fade-in">
  <!-- 用户信息区域 -->
  <view class="header-section glass-card">
    <view class="user-avatar" bindlongpress="goToAdmin">
      <image src="{{userInfo.avatarUrl}}" class="avatar-img" mode="aspectFill" wx:if="{{userInfo.avatarUrl}}" />
      <view class="avatar-placeholder" wx:else>🎭</view>
    </view>
    <view class="user-info">
      <view class="user-name">{{displayName || userInfo.nickName || '戏剧爱好者'}}</view>
      <view class="user-title">魔都戏剧爱好者</view>
    </view>
    <button class="btn-outline edit-btn" bindtap="editUserInfo">
      <view class="btn-text">编辑资料</view>
      <view class="btn-icon">﹥</view>
    </button>
  </view>

  <!-- 官方头像昵称填写能力面板 -->
  <view wx:if="{{showEditorPanel}}" class="editor-panel glass-card">
    <view class="section-title">
      <view class="title-text">选择微信头像和昵称</view>
    </view>
    <view class="editor-row">
      <button open-type="chooseAvatar" bindchooseavatar="onChooseAvatar" class="choose-avatar-btn">选择头像</button>
      <image wx:if="{{pendingAvatarUrl}}" src="{{pendingAvatarUrl}}" class="avatar-preview" mode="aspectFill"/>
    </view>
    <view class="editor-row">
      <input class="nickname-input" type="nickname" placeholder="请输入昵称"
             bindinput="onNicknameInput" value="{{pendingNickname}}"/>
    </view>
    <view class="editor-actions">
      <button class="btn-secondary" bindtap="closeEditorPanel">取消</button>
      <button class="btn-success" bindtap="saveEditorProfile">保存</button>
    </view>
  </view>

  <!-- 我的收藏 -->
  <view class="collection-section glass-card">
    <view class="section-title">
      <view class="title-text">我的收藏</view>
    </view>
    <view class="collection-single">
      <view class="collection-item-large" bindtap="goToVoiceEcho">
        <view class="collection-icon-large">🎵</view>
        <view class="collection-content">
          <view class="collection-name">收藏的语音包</view>
          <view class="collection-desc">已收藏 {{purchasedVoicePacks || 0}} 个语音包</view>
        </view>
        <view class="collection-arrow">〉</view>
      </view>
    </view>
  </view>



  <!-- 设置选项 -->
  <view class="settings-section glass-card">
    <view class="settings-item" bindtap="contactUs">
      <view class="settings-text">联系我们</view>
      <view class="settings-arrow">〉</view>
    </view>
    <view class="settings-item" bindtap="clearData">
      <view class="settings-text">清除缓存</view>
      <view class="settings-arrow">〉</view>
    </view>
    <view class="settings-item" bindtap="aboutApp">
      <view class="settings-text">关于应用</view>
      <view class="settings-arrow">〉</view>
    </view>
    <view class="settings-item" bindtap="handleLogout" wx:if="{{userInfo.nickName && userInfo.nickName !== '未登录用户'}}">
      <view class="settings-text red">退出登录</view>
      <view class="settings-arrow">〉</view>
    </view>
  </view>

  <!-- 版本信息 -->
  <view class="version-info">
    <view class="version-text">戏剧回响 v2.1.0</view>
    <view class="copyright">© 2024 魔都戏剧</view>
  </view>

  <!-- 新用户引导全屏层 -->
  <view wx:if="{{showOnboardingOverlay}}" class="onboarding-mask">
    <view class="onboarding-card">
      <view class="onboarding-title">完善个人资料</view>
      <view class="onboarding-desc">为更好的使用体验，请授权获取微信头像与昵称，或设置个性昵称。</view>
      <view class="onboarding-actions">
        <button class="btn-secondary" bindtap="dismissOnboarding">暂不</button>
        <button class="btn-success" bindtap="startOneTapOnboarding">一键授权完善</button>
      </view>
    </view>
  </view>

  <!-- 授权弹窗 -->
  <auth-modal 
    show="{{showAuthModal}}" 
    title="授权登录"
    subtitle="为了给您提供更好的个人中心服务"
    bind:success="onAuthSuccess"
    bind:cancel="onAuthCancel"
    bind:close="onAuthClose">
  </auth-modal>
</view>